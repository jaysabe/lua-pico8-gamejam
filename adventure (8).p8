pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _init()
	stars = {}
	
	for i=1,50 do
		s = {x=rnd(127),
							y=rnd(127),
							r=rnd(2),
							v=rnd()+0.1,
							c=flr(rnd(20))}
		add(stars,s)
	end
	
	-- character init
	cx = 80
	cy = 80
	
	area_size = 40
	half_area = area_size / 2
	
	dragon_x = cx
	dragon_y = cy
	
	-- timer 
	move_delay = 7
	b_timer = move_delay
end


function update_dragon()
	b_timer -= 1
	
	if b_timer <= 0 then
	
		-- get a random num between 0 and 3
		local direction = flr(rnd(4))
	
		if direction == 0 and dragon_y > cy - half_area then
			--move up
			dragon_y -= 1
		elseif direction == 1 and dragon_y < cy + half_area then
			-- move down
			dragon_y += 1
		elseif direction == 2 and dragon_x > cx - half_area then
			-- move left 
			dragon_x -= 1
		elseif direction == 3 and dragon_x < dragon_x + half_area then
			dragon_x += 1
			end
			
			b_timer = move_delay
	end
end

function _update()
	
	oldx = cx
	oldy = cy
		
	for s in all(stars) do
		s.y += s.v
		
		s.c += 1
		
		if s.c % 30 == 0 then 
			s.r = (s.r+1)%2
		end
		
		if s.y > 127 then
			del(stars,s)
			news = {x=rnd(127),
											y=-10+rnd(5),
											r=rnd(2),
											v=rnd()+0.1,
											c=flr(rnd(20))}
			add(stars, news)
		end
	end
		
		update_dragon()
		
	if (btn(⬅️)) cx = cx - 1
	if (btn(➡️)) cx = cx + 1
	if (btn(⬆️)) cy = cy - 1
	if (btn(⬇️)) cy = cy + 1
	
	if mapcollide(x,y) then
		cx = oldx
		cy = oldy
	end
end

function _draw()
cls()
map()

	for s in all(stars) do
		circ(s.x,s.y,s.r,7)
	end

-- spawn monster and hero
spr(2,cx+3,cy)
spr(1,cx,cy)
spr(3,dragon_x,dragon_y)
end
-->8
function mapcollide(x,y)

	x1 = cx \ 8
	y1 = cy \ 8
	x2 = (cx+7) \ 8
	y2 = (cy+7) \ 8
	
	a = fget(mget(x1,y1),0)
	b = fget(mget(x2,y1),0)
	c = fget(mget(x1,y2),0)
	d = fget(mget(x2,y2),0)
	
	return (a or b or c or d)
	
end


function spritecollide(xp,yp,xe,ye)
	a = xp + 7 < xe
	b = xp > xe+7
	c = yp + 7 < ye
	d = yp > ye + 7
	
	return not (a or b or c or d)
	
end


__gfx__
00000000000000000000000000900900001001000000000033333333333333333333333333333333555333333333333333333333333333330000000000000000
00000000000000000000000000699600006116000006600033333333333333333333333333333333333555555333333333333333333333330000000000000000
00700700000a00000000000009a0a90001e0e1000006600033333333333333333333333333333333333333333555555533333333333333330000000000000000
000770000072000000a9aa0006999000061110000006600033333333333333333333333333333333333333333333333355333333333333330000000000000000
000770000702000000aa9a00909a7909801771080006600033333333333333333333333333333333333333333333333333533333333333330000000000000000
0070070000020000009aaa00a079970a807227080006600033333333333333333333333333333333333333333333333333355333333333330000000000000000
000000000002000000aaa90090799709207117020006600033333333333333333333333333333333333333333333333333333533333333330000000000000000
00000000000000000000000007000070070000700006600033333333333333333333333333333333333333333333333333333355333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333533333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333353333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333335333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333335333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333333533330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333333353330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333333335330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333333333530000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333333333530000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333333333350000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333333333350000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000053333333333333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000035333333333333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033533333333333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033353333333333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033335333333333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033335333333333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333533333333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333355333333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333335333333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333553333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333335333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333335333333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333553333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333355333333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333533333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333353333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333335333333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333533333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333353333333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333335533333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333353333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333335333333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333553333333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333335533333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333355333333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333533333333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333355533333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333555333333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333533333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333353333333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333335553333333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333335533333333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333355533333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333355333333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333553333333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333335555333333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333335553333333330000000000000000
00000000000000000000000000000000000000000000000033333333333333333333333333333333333333333333333333333335533333330000000000000000
__gff__
0010000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
060708565758595a5b5c5d565758595a5b5c5d565758595a5b5c5d090a0b0c060708090a0b0c060700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
161718666768696a6b6c6d666768696a6b6c6d666768696a6b6c6d191a1b1c161718191a1b1c161700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
262728767778797a7b7c7d767778797a7b7c7d767778797a7b7c7d292a2b2c262728292a2b2c262700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
060708090a0b0c0d161718191a1b1c363738393a3b3c3d36363738393a3b3c363738393a3b3c363700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
161718191a1b1c1d262728292a2b2c464748494a4b4c4d46464748494a4b4c46474849060708090a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
262728292a2b2c2d363738393a3b3c565758595a5b5c5d56565758595a5b5c56575859161718191a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
363738393a3b3c3d464748494a4b4c666768696a6b6c6d66060708090a0b0c66676869262728292a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
464748494a4b4c4d565758595a5b5c767778797a7b7c7d76161718191a1b1c76777879363738393a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0708090a0b0c0d060708090a0b0c0d060708090a0b0c0d060708090a0b0c0d06070809464748494a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1718191a1b1c1d161718191a1b1c1d161718191a1b1c1d161718191a1b1c1d16171819565758595a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2728292a2b2c2d262728292a2b2c2d262728292a2b2c2d262728292a2b2c2d26272829666768696a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3738393a3b3c3d363738393a3b3c3d363738393a3b3c3d363738393a3b3c3d36373839767778797a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4748494a4b4c4d464748494a4b4c4d464748494a4b4c4d464748494a4b4c4d46474849363738393a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00000000000002c55000000285502f5502c5502f5501d5502f5502b5502b5502a5502e550225502c550200502b550215502155029550310501f5501f55024550235503b05021550245501b5501a5501955006550
